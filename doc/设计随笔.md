# 设计思路
单机模式用sqlite；集群模式使用MySQL；性能瓶颈在MySQL；实现起来也简单

raft用于广播

服务端向客户端发送报文时，使用广播模式

处理接收到的消息，单独一个线程池，处理后即时发报文，发送消息，每次也发送之前未完成的消息，这样可以保证有序性

基于[https://juejin.cn/post/6963591832244584484]，只需要在重连时重试即可

在数据库中记录topic filter最后一次被匹配的时间，按这个时间进行清理
## 数据库初始化及升级

关于单机/集群模式下，数据库的初始化，以及后续的升级问题，如何处理？

新增元数据表，里面为key value形式，如果存在该表，则表示已完成初始化，再根据历史与当前版本号进行升级

解析方法：使用mybatis的scriptRunner执行

# 问题汇总

# todo项

Q:topic filter的清理

A:暂不清理

保留消息

遗嘱消息