<mxfile host="drawio-plugin" modified="2025-01-30T14:06:38.246Z" agent="5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36" etag="FsySjy-0QBEDiMu-8qap" version="20.5.3" type="embed" pages="4"><diagram id="6msJLrnT3YrAkbBIrzmL" name="入站消息"><mxGraphModel dx="3067" dy="1200" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0"><root><mxCell id="0"/><mxCell id="1" parent="0"/><mxCell id="iESZrySSaNiz9em4wrno-1" value="服务端" style="swimlane;whiteSpace=wrap;html=1;startSize=23;" vertex="1" parent="1"><mxGeometry x="414" y="240" width="1346" height="2480" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-2" value="qos=1&lt;br&gt;或者&lt;br&gt;qos=2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-6" target="iESZrySSaNiz9em4wrno-8"><mxGeometry relative="1" as="geometry"><mxPoint x="450" y="439.9999999999998" as="targetPoint"/></mxGeometry></mxCell><mxCell id="iESZrySSaNiz9em4wrno-77" value="qos=0" style="edgeStyle=none;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-6" target="iESZrySSaNiz9em4wrno-76"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-6" value="收到publish消息" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="iESZrySSaNiz9em4wrno-1"><mxGeometry x="390" y="300" width="120" height="60" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-8" target="iESZrySSaNiz9em4wrno-12"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-8" value="按messageId、clientId查询" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="iESZrySSaNiz9em4wrno-1"><mxGeometry x="390" y="466" width="120" height="70" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-12" target="iESZrySSaNiz9em4wrno-17"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-11" value="是" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="iESZrySSaNiz9em4wrno-10"><mxGeometry x="-0.15" y="-1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="iESZrySSaNiz9em4wrno-82" value="否" style="edgeStyle=none;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-12" target="iESZrySSaNiz9em4wrno-29"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-12" value="消息是否存在" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="iESZrySSaNiz9em4wrno-1"><mxGeometry x="390" y="590" width="120" height="70" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-16" value="是，qos=1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-17" target="iESZrySSaNiz9em4wrno-47"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-106" style="rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-17" target="iESZrySSaNiz9em4wrno-49"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-108" value="是，qps=2" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="iESZrySSaNiz9em4wrno-106"><mxGeometry x="-0.8186" y="1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="iESZrySSaNiz9em4wrno-112" value="否" style="edgeStyle=orthogonalEdgeStyle;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-17" target="iESZrySSaNiz9em4wrno-63"><mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="276" y="765"/><mxPoint x="276" y="1425"/></Array></mxGeometry></mxCell><mxCell id="iESZrySSaNiz9em4wrno-17" value="消息的qos与报文的是否一致" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="iESZrySSaNiz9em4wrno-1"><mxGeometry x="390" y="730" width="120" height="70" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-84" value="" style="edgeStyle=none;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-29" target="iESZrySSaNiz9em4wrno-83"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-29" value="存入receive_message表" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="iESZrySSaNiz9em4wrno-1"><mxGeometry x="614" y="595" width="120" height="60" as="geometry"/></mxCell><mxCell id="hggOCaARPzmzUswJbIeH-9" style="edgeStyle=none;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-31" target="hggOCaARPzmzUswJbIeH-1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-31" value="收到pubrel消息" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="iESZrySSaNiz9em4wrno-1"><mxGeometry x="389.99999999999955" y="1655" width="120" height="60" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-115" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-44" target="iESZrySSaNiz9em4wrno-114"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-44" value="发送pubcomp" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="iESZrySSaNiz9em4wrno-1"><mxGeometry x="589.9999999999995" y="1810" width="120" height="60" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-45" value="是" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-47" target="iESZrySSaNiz9em4wrno-55"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-102" style="edgeStyle=orthogonalEdgeStyle;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-47" target="iESZrySSaNiz9em4wrno-87"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-103" value="否" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="iESZrySSaNiz9em4wrno-102"><mxGeometry x="-0.5102" y="1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="iESZrySSaNiz9em4wrno-47" value="发送puback；发送puback是否成功" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="iESZrySSaNiz9em4wrno-1"><mxGeometry x="390" y="1050" width="120" height="70" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-98" style="edgeStyle=orthogonalEdgeStyle;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-49" target="iESZrySSaNiz9em4wrno-87"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-49" value="重新发送PUBREC报文" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="iESZrySSaNiz9em4wrno-1"><mxGeometry x="814" y="927" width="120" height="60" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-113" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-51" target="iESZrySSaNiz9em4wrno-44"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-51" value="更新已收到pubrel，增加消息分发异步任务" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="iESZrySSaNiz9em4wrno-1"><mxGeometry x="589.9999999999995" y="1950" width="120" height="60" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-104" style="edgeStyle=orthogonalEdgeStyle;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-55" target="iESZrySSaNiz9em4wrno-87"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-55" value="增加分发消息的异步任务" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="iESZrySSaNiz9em4wrno-1"><mxGeometry x="391" y="1224" width="120" height="70" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-97" style="edgeStyle=orthogonalEdgeStyle;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-76" target="iESZrySSaNiz9em4wrno-87"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-76" value="存入receive_message表&lt;br&gt;增加分发消息的异步任务" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="iESZrySSaNiz9em4wrno-1"><mxGeometry x="614" y="300" width="120" height="60" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-88" value="是" style="edgeStyle=none;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-83" target="iESZrySSaNiz9em4wrno-87"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-83" value="是否唯一索引冲突" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="iESZrySSaNiz9em4wrno-1"><mxGeometry x="814" y="595" width="120" height="60" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-93" value="否，qos=2" style="edgeStyle=none;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-83" target="iESZrySSaNiz9em4wrno-49"><mxGeometry relative="1" as="geometry"><mxPoint x="874" y="795" as="sourcePoint"/></mxGeometry></mxCell><mxCell id="iESZrySSaNiz9em4wrno-94" value="否，qos=1" style="edgeStyle=none;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-83" target="iESZrySSaNiz9em4wrno-47"><mxGeometry x="-0.7896" y="5" relative="1" as="geometry"><mxPoint x="814" y="765" as="sourcePoint"/><mxPoint x="476" y="1010" as="targetPoint"/><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="iESZrySSaNiz9em4wrno-87" value="结束" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="iESZrySSaNiz9em4wrno-1"><mxGeometry x="1116" y="590" width="120" height="60" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-109" style="edgeStyle=orthogonalEdgeStyle;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="iESZrySSaNiz9em4wrno-63" target="iESZrySSaNiz9em4wrno-87"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-63" value="断开连接" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="iESZrySSaNiz9em4wrno-1"><mxGeometry x="391" y="1390" width="120" height="70" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-114" value="结束" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="iESZrySSaNiz9em4wrno-1"><mxGeometry x="789.9999999999995" y="1810" width="120" height="60" as="geometry"/></mxCell><mxCell id="hggOCaARPzmzUswJbIeH-5" value="是" style="edgeStyle=orthogonalEdgeStyle;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="hggOCaARPzmzUswJbIeH-1" target="iESZrySSaNiz9em4wrno-51"><mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="450" y="1980"/></Array></mxGeometry></mxCell><mxCell id="hggOCaARPzmzUswJbIeH-10" value="否" style="edgeStyle=orthogonalEdgeStyle;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="iESZrySSaNiz9em4wrno-1" source="hggOCaARPzmzUswJbIeH-1" target="iESZrySSaNiz9em4wrno-44"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="hggOCaARPzmzUswJbIeH-1" value="更新已收到pubrel是否成功" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="iESZrySSaNiz9em4wrno-1"><mxGeometry x="389.99999999999955" y="1810" width="120" height="60" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-57" value="客户端" style="swimlane;whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="-270" y="240" width="684" height="2480" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-58" value="发送publish消息" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="iESZrySSaNiz9em4wrno-57"><mxGeometry x="109.99999999999955" y="90" width="120" height="60" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-59" value="发送pubrel消息" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="iESZrySSaNiz9em4wrno-57"><mxGeometry x="99.99999999999955" y="1655" width="120" height="60" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-60" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="iESZrySSaNiz9em4wrno-58" target="iESZrySSaNiz9em4wrno-6"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="iESZrySSaNiz9em4wrno-61" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="iESZrySSaNiz9em4wrno-59" target="iESZrySSaNiz9em4wrno-31"><mxGeometry relative="1" as="geometry"/></mxCell></root></mxGraphModel></diagram><diagram id="k4jWE-amrAnNTFHHnCet" name="异步任务-分发消息任务"><mxGraphModel dx="1552" dy="840" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0"><root><mxCell id="0"/><mxCell id="1" parent="0"/><mxCell id="0fl1IppJ4GoYzok4VV-b-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="0fl1IppJ4GoYzok4VV-b-1" target="0fl1IppJ4GoYzok4VV-b-2"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="0fl1IppJ4GoYzok4VV-b-1" value="根据messageid和clientid查询消息" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="340" y="140" width="120" height="60" as="geometry"/></mxCell><mxCell id="0fl1IppJ4GoYzok4VV-b-5" value="否" style="edgeStyle=orthogonalEdgeStyle;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="0fl1IppJ4GoYzok4VV-b-2" target="0fl1IppJ4GoYzok4VV-b-4"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="fluc5wtObKBqnOCHpVQG-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="0fl1IppJ4GoYzok4VV-b-2" target="fluc5wtObKBqnOCHpVQG-1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="0fl1IppJ4GoYzok4VV-b-2" value="消息是否存在" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="340" y="280" width="120" height="60" as="geometry"/></mxCell><mxCell id="0fl1IppJ4GoYzok4VV-b-4" value="结束" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="540" y="280" width="120" height="60" as="geometry"/></mxCell><mxCell id="0fl1IppJ4GoYzok4VV-b-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="0fl1IppJ4GoYzok4VV-b-6" target="0fl1IppJ4GoYzok4VV-b-8"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="0fl1IppJ4GoYzok4VV-b-6" value="根据topic匹配topic filter" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="340" y="579" width="120" height="60" as="geometry"/></mxCell><mxCell id="0fl1IppJ4GoYzok4VV-b-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="0fl1IppJ4GoYzok4VV-b-8" target="0fl1IppJ4GoYzok4VV-b-10"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="0fl1IppJ4GoYzok4VV-b-8" value="根据topic filter匹配客户端" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="340" y="719" width="120" height="60" as="geometry"/></mxCell><mxCell id="fluc5wtObKBqnOCHpVQG-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="0fl1IppJ4GoYzok4VV-b-10" target="0fl1IppJ4GoYzok4VV-b-4"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="0fl1IppJ4GoYzok4VV-b-10" value="批量插入send_message消息及其异步任务" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="340" y="859" width="120" height="60" as="geometry"/></mxCell><mxCell id="fluc5wtObKBqnOCHpVQG-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="fluc5wtObKBqnOCHpVQG-1" target="0fl1IppJ4GoYzok4VV-b-6"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="fluc5wtObKBqnOCHpVQG-4" value="是" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="fluc5wtObKBqnOCHpVQG-3"><mxGeometry x="-0.3091" y="1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="fluc5wtObKBqnOCHpVQG-5" value="否" style="edgeStyle=orthogonalEdgeStyle;rounded=0;jumpStyle=arc;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="fluc5wtObKBqnOCHpVQG-1" target="0fl1IppJ4GoYzok4VV-b-4"><mxGeometry x="-0.36" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="fluc5wtObKBqnOCHpVQG-1" value="删除该条记录是否成功" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="340" y="420" width="120" height="60" as="geometry"/></mxCell></root></mxGraphModel></diagram><diagram id="K6ayVnm4Q7NiHEKUyF0k" name="出站消息"><mxGraphModel dx="1826" dy="988" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0"><root><mxCell id="0"/><mxCell id="1" parent="0"/><mxCell id="GzOiODAGneL9vTj7HFSQ-1" value="客户端" style="swimlane;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="340" y="420" width="430" height="1560" as="geometry"/></mxCell><mxCell id="GzOiODAGneL9vTj7HFSQ-14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="GzOiODAGneL9vTj7HFSQ-1" source="GzOiODAGneL9vTj7HFSQ-4" target="GzOiODAGneL9vTj7HFSQ-7" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="GzOiODAGneL9vTj7HFSQ-4" value="收到publish消息" style="rounded=1;whiteSpace=wrap;html=1;" parent="GzOiODAGneL9vTj7HFSQ-1" vertex="1"><mxGeometry x="170" y="50" width="120" height="60" as="geometry"/></mxCell><mxCell id="GzOiODAGneL9vTj7HFSQ-7" value="发送puback消息" style="rounded=1;whiteSpace=wrap;html=1;" parent="GzOiODAGneL9vTj7HFSQ-1" vertex="1"><mxGeometry x="170" y="200" width="120" height="60" as="geometry"/></mxCell><mxCell id="bqhSTv_wxcXyNgmSgenb-22" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="GzOiODAGneL9vTj7HFSQ-1" source="GzOiODAGneL9vTj7HFSQ-19" target="bqhSTv_wxcXyNgmSgenb-1" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="GzOiODAGneL9vTj7HFSQ-19" value="收到publish消息" style="whiteSpace=wrap;html=1;rounded=1;" parent="GzOiODAGneL9vTj7HFSQ-1" vertex="1"><mxGeometry x="170" y="540" width="120" height="60" as="geometry"/></mxCell><mxCell id="bqhSTv_wxcXyNgmSgenb-17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="GzOiODAGneL9vTj7HFSQ-1" source="bqhSTv_wxcXyNgmSgenb-14" target="bqhSTv_wxcXyNgmSgenb-16" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="bqhSTv_wxcXyNgmSgenb-14" value="收到pubrel消息" style="whiteSpace=wrap;html=1;rounded=1;" parent="GzOiODAGneL9vTj7HFSQ-1" vertex="1"><mxGeometry x="170" y="1140" width="120" height="60" as="geometry"/></mxCell><mxCell id="bqhSTv_wxcXyNgmSgenb-16" value="发送pubcomp消息" style="whiteSpace=wrap;html=1;rounded=1;" parent="GzOiODAGneL9vTj7HFSQ-1" vertex="1"><mxGeometry x="170" y="1280" width="120" height="60" as="geometry"/></mxCell><mxCell id="bqhSTv_wxcXyNgmSgenb-1" value="发送pubrec消息" style="whiteSpace=wrap;html=1;rounded=1;" parent="GzOiODAGneL9vTj7HFSQ-1" vertex="1"><mxGeometry x="170" y="700" width="120" height="60" as="geometry"/></mxCell><mxCell id="GzOiODAGneL9vTj7HFSQ-2" value="服务端" style="swimlane;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="770" y="420" width="440" height="1560" as="geometry"/></mxCell><mxCell id="GzOiODAGneL9vTj7HFSQ-3" value="发送publish消息" style="rounded=1;whiteSpace=wrap;html=1;" parent="GzOiODAGneL9vTj7HFSQ-2" vertex="1"><mxGeometry x="150" y="50" width="120" height="60" as="geometry"/></mxCell><mxCell id="GzOiODAGneL9vTj7HFSQ-17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="GzOiODAGneL9vTj7HFSQ-2" source="GzOiODAGneL9vTj7HFSQ-10" target="GzOiODAGneL9vTj7HFSQ-16" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="GzOiODAGneL9vTj7HFSQ-10" value="收到puback消息" style="rounded=1;whiteSpace=wrap;html=1;" parent="GzOiODAGneL9vTj7HFSQ-2" vertex="1"><mxGeometry x="150" y="200" width="120" height="60" as="geometry"/></mxCell><mxCell id="GzOiODAGneL9vTj7HFSQ-16" value="更新消息puback状态；完成publish异步任务" style="rounded=1;whiteSpace=wrap;html=1;" parent="GzOiODAGneL9vTj7HFSQ-2" vertex="1"><mxGeometry x="150" y="340" width="120" height="60" as="geometry"/></mxCell><mxCell id="GzOiODAGneL9vTj7HFSQ-18" value="发送publish消息" style="rounded=1;whiteSpace=wrap;html=1;" parent="GzOiODAGneL9vTj7HFSQ-2" vertex="1"><mxGeometry x="150" y="540" width="120" height="60" as="geometry"/></mxCell><mxCell id="bqhSTv_wxcXyNgmSgenb-13" value="发送pubrel消息" style="rounded=1;whiteSpace=wrap;html=1;" parent="GzOiODAGneL9vTj7HFSQ-2" vertex="1"><mxGeometry x="150" y="1140" width="120" height="60" as="geometry"/></mxCell><mxCell id="bqhSTv_wxcXyNgmSgenb-20" value="收到pubcomp消息&lt;div&gt;更新pubcomp状态；&lt;/div&gt;&lt;div&gt;完成pubrel异步任务&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="GzOiODAGneL9vTj7HFSQ-2" vertex="1"><mxGeometry x="150" y="1280" width="120" height="60" as="geometry"/></mxCell><mxCell id="bqhSTv_wxcXyNgmSgenb-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="GzOiODAGneL9vTj7HFSQ-2" source="bqhSTv_wxcXyNgmSgenb-6" target="bqhSTv_wxcXyNgmSgenb-8" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="bqhSTv_wxcXyNgmSgenb-6" value="收到pubrec消息" style="rounded=1;whiteSpace=wrap;html=1;" parent="GzOiODAGneL9vTj7HFSQ-2" vertex="1"><mxGeometry x="150" y="700" width="120" height="60" as="geometry"/></mxCell><mxCell id="bqhSTv_wxcXyNgmSgenb-8" value="&lt;div&gt;更新pubrec状态；&lt;/div&gt;完成publish异步任务；增加pubrel异步任务&lt;div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="GzOiODAGneL9vTj7HFSQ-2" vertex="1"><mxGeometry x="150" y="840" width="120" height="60" as="geometry"/></mxCell><mxCell id="GzOiODAGneL9vTj7HFSQ-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="GzOiODAGneL9vTj7HFSQ-3" target="GzOiODAGneL9vTj7HFSQ-4" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="GzOiODAGneL9vTj7HFSQ-15" value="qos=1" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="GzOiODAGneL9vTj7HFSQ-5" vertex="1" connectable="0"><mxGeometry x="-0.5226" y="1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="GzOiODAGneL9vTj7HFSQ-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="GzOiODAGneL9vTj7HFSQ-7" target="GzOiODAGneL9vTj7HFSQ-10" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="GzOiODAGneL9vTj7HFSQ-20" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="GzOiODAGneL9vTj7HFSQ-18" target="GzOiODAGneL9vTj7HFSQ-19" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="GzOiODAGneL9vTj7HFSQ-21" value="qos=2" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="GzOiODAGneL9vTj7HFSQ-20" vertex="1" connectable="0"><mxGeometry x="-0.5613" y="-2" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="bqhSTv_wxcXyNgmSgenb-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="bqhSTv_wxcXyNgmSgenb-13" target="bqhSTv_wxcXyNgmSgenb-14" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="bqhSTv_wxcXyNgmSgenb-21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="bqhSTv_wxcXyNgmSgenb-16" target="bqhSTv_wxcXyNgmSgenb-20" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="bqhSTv_wxcXyNgmSgenb-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="bqhSTv_wxcXyNgmSgenb-1" target="bqhSTv_wxcXyNgmSgenb-6" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell></root></mxGraphModel></diagram><diagram id="4qeNa46pEVVLE3i9eAhn" name="异步任务-发送publish报文"><mxGraphModel dx="1552" dy="840" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0"><root><mxCell id="0"/><mxCell id="1" parent="0"/><mxCell id="yzGZU8PBOy7eUI11wV_d-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yzGZU8PBOy7eUI11wV_d-1" target="yzGZU8PBOy7eUI11wV_d-2" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="yzGZU8PBOy7eUI11wV_d-1" value="开始" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="160" y="120" width="120" height="60" as="geometry"/></mxCell><mxCell id="yzGZU8PBOy7eUI11wV_d-5" value="是" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yzGZU8PBOy7eUI11wV_d-2" target="yzGZU8PBOy7eUI11wV_d-4" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="yzGZU8PBOy7eUI11wV_d-7" value="否" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yzGZU8PBOy7eUI11wV_d-2" target="yzGZU8PBOy7eUI11wV_d-6" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="yzGZU8PBOy7eUI11wV_d-2" value="查询消息是否存在" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="160" y="260" width="120" height="60" as="geometry"/></mxCell><mxCell id="yzGZU8PBOy7eUI11wV_d-11" value="qos=1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yzGZU8PBOy7eUI11wV_d-4" target="yzGZU8PBOy7eUI11wV_d-10" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="7t1D-U24dZ-YpqizAq16-2" value="qos=2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yzGZU8PBOy7eUI11wV_d-4" target="7t1D-U24dZ-YpqizAq16-1" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="yzGZU8PBOy7eUI11wV_d-4" value="根据qos等级去处理" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="160" y="400" width="120" height="60" as="geometry"/></mxCell><mxCell id="yzGZU8PBOy7eUI11wV_d-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yzGZU8PBOy7eUI11wV_d-6" target="yzGZU8PBOy7eUI11wV_d-8" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="yzGZU8PBOy7eUI11wV_d-6" value="完成异步任务" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="360" y="260" width="120" height="60" as="geometry"/></mxCell><mxCell id="yzGZU8PBOy7eUI11wV_d-8" value="结束" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="560" y="260" width="120" height="60" as="geometry"/></mxCell><mxCell id="7t1D-U24dZ-YpqizAq16-5" value="是" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="yzGZU8PBOy7eUI11wV_d-10" target="yzGZU8PBOy7eUI11wV_d-6" edge="1"><mxGeometry x="-0.9672" relative="1" as="geometry"><Array as="points"><mxPoint x="220" y="680"/><mxPoint x="110" y="680"/><mxPoint x="110" y="70"/><mxPoint x="420" y="70"/></Array><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="7t1D-U24dZ-YpqizAq16-7" value="否" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="yzGZU8PBOy7eUI11wV_d-10" target="7t1D-U24dZ-YpqizAq16-6" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="yzGZU8PBOy7eUI11wV_d-10" value="是否收到puback" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="160" y="540" width="120" height="60" as="geometry"/></mxCell><mxCell id="KldHH4KO9R3ikEGegbNf-1" value="否" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;" parent="1" source="7t1D-U24dZ-YpqizAq16-1" target="7t1D-U24dZ-YpqizAq16-6" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="KldHH4KO9R3ikEGegbNf-2" value="是" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;" parent="1" source="7t1D-U24dZ-YpqizAq16-1" target="yzGZU8PBOy7eUI11wV_d-6" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="7t1D-U24dZ-YpqizAq16-1" value="是否收到pubrec报文" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="360" y="400" width="120" height="60" as="geometry"/></mxCell><mxCell id="7t1D-U24dZ-YpqizAq16-15" value="是" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;" parent="1" source="7t1D-U24dZ-YpqizAq16-6" edge="1"><mxGeometry x="-0.8333" relative="1" as="geometry"><mxPoint x="220" y="640" as="targetPoint"/><Array as="points"><mxPoint x="420" y="680"/><mxPoint x="220" y="680"/></Array><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="7t1D-U24dZ-YpqizAq16-18" value="否" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;" parent="1" source="7t1D-U24dZ-YpqizAq16-6" target="7t1D-U24dZ-YpqizAq16-17" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="7t1D-U24dZ-YpqizAq16-6" value="是否为重复消息" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="360" y="540" width="120" height="60" as="geometry"/></mxCell><mxCell id="KldHH4KO9R3ikEGegbNf-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=classic;endFill=1;" parent="1" source="7t1D-U24dZ-YpqizAq16-17" target="KldHH4KO9R3ikEGegbNf-4" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="7t1D-U24dZ-YpqizAq16-17" value="发送消息" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="560" y="540" width="120" height="60" as="geometry"/></mxCell><mxCell id="KldHH4KO9R3ikEGegbNf-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=1;entryDx=0;entryDy=0;endArrow=classic;endFill=1;" parent="1" source="KldHH4KO9R3ikEGegbNf-4" target="yzGZU8PBOy7eUI11wV_d-6" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="KldHH4KO9R3ikEGegbNf-4" value="publish次数+1" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="560" y="400" width="120" height="60" as="geometry"/></mxCell></root></mxGraphModel></diagram></mxfile>